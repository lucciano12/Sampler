<header class="border-bottom bg-white sticky-top">
  <div class="container py-2 d-flex align-items-center gap-3">
    <div class="d-flex align-items-center gap-2 me-auto">
      <i class="bi bi-music-note-beamed fs-4 text-primary"></i>
      <span class="fw-semibold">Sampler</span>
    </div>

    <!-- Filtro por fuente -->
    <select class="form-select w-auto" [formControl]="fuente" aria-label="Filtrar por fuente">
      <option value="todas">Todas</option>
      <option value="YouTube">YouTube</option>
      <option value="Spotify">Spotify</option>
    </select>

    <!-- Buscador -->
    <div class="input-group" style="max-width: 520px;">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input type="search" class="form-control" placeholder="Buscar por título, artista, fuente o descripción…" [formControl]="q">
    </div>
  </div>
</header>


<main class="container my-4">
  <div *ngIf="loading" class="alert alert-secondary">Cargando…</div>
  <div *ngIf="!loading && errorMsg" class="alert alert-danger">{{ errorMsg }}</div>
  <div *ngIf="!loading && !errorMsg && filtered.length === 0" class="alert alert-warning">Sin resultados</div>

  <div class="row g-3">
    <div class="col-12 col-md-6 col-lg-4" *ngFor="let s of filtered">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <h6 class="card-title mb-1 text-truncate">{{ s.titulo }}</h6>
          <div class="text-muted small mb-2 text-truncate">{{ s.artista }}</div>

          <div class="d-flex flex-wrap gap-2 mb-3">
            <span class="badge bg-primary-subtle text-primary-emphasis">Fuente: {{ s.fuente }}</span>
            <span class="badge bg-secondary-subtle text-secondary-emphasis" *ngIf="s.key">Key: {{ s.key }}</span>
            <span class="badge bg-info-subtle text-info-emphasis" *ngIf="s.tempo">Tempo: {{ s.tempo }} bpm</span>
            <span class="badge bg-success-subtle text-success-emphasis" *ngIf="s.genero">{{ s.genero }}</span>
            <span class="badge bg-warning-subtle text-warning-emphasis" *ngIf="s.estilo">{{ s.estilo }}</span>
          </div>

          <p class="small text-body-secondary mb-3" *ngIf="s.descripcion" style="min-height:2.5em">
            {{ s.descripcion }}
          </p>

          <div class="mt-auto d-flex gap-2">
            <a class="btn btn-outline-primary btn-sm" [href]="s.enlace" target="_blank" rel="noopener">
              Abrir enlace
            </a>
            <button class="btn btn-primary btn-sm" (click)="abrirDetalle(s)">Ver detalle</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Offcanvas lateral -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasDetalle" aria-labelledby="offcanvasDetalleLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasDetalleLabel">{{ sampleSel?.titulo || 'Detalle' }}</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body d-flex flex-column">
    <ul class="nav nav-tabs mb-3" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-plataformas" role="tab">Plataformas</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-comentarios" role="tab">Comentarios</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-metadatos" role="tab">Metadatos</button></li>
    </ul>

    <div class="tab-content flex-grow-1 overflow-auto">
      <div class="tab-pane fade show active" id="tab-plataformas" role="tabpanel">
        <div class="list-group">
          <a *ngFor="let p of sampleSel?.plataformas" [href]="p.url" target="_blank" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <span><i class="bi bi-link-45deg me-1"></i>{{ p.nombre }}</span>
            <span class="badge bg-primary">{{ p.tipo }}</span>
          </a>
        </div>
      </div>

      <div class="tab-pane fade" id="tab-comentarios" role="tabpanel">
        <div class="list-group small" *ngIf="sampleSel?.comentarios?.length; else noCom">
          <div class="list-group-item" *ngFor="let c of sampleSel?.comentarios">
            <div class="fw-semibold">{{ c.usuario }}</div>
            <div class="text-body-secondary">{{ c.texto }}</div>
          </div>
        </div>
        <ng-template #noCom><p class="text-body-secondary">Sin comentarios.</p></ng-template>
      </div>

      <div class="tab-pane fade" id="tab-metadatos" role="tabpanel">
        <dl class="row small">
          <dt class="col-sm-3">Artista</dt><dd class="col-sm-9">{{ sampleSel?.artista }}</dd>
          <dt class="col-sm-3">Key</dt><dd class="col-sm-9">{{ sampleSel?.key || '—' }}</dd>
          <dt class="col-sm-3">Tempo</dt><dd class="col-sm-9">{{ sampleSel?.tempo || '—' }}</dd>
          <dt class="col-sm-3">Género</dt><dd class="col-sm-9">{{ sampleSel?.genero || '—' }}</dd>
          <dt class="col-sm-3">Estilo</dt><dd class="col-sm-9">{{ sampleSel?.estilo || '—' }}</dd>
        </dl>
      </div>
    </div>
  </div>
</div>

